---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
devtools::document()
pacman::p_load(tidyverse, recipes, tidyr)
```



```{r}
load("gams_sub.Rdata")

games <- gams_sub %>%
  filter(league_id == 82) %>%
  mutate_at(vars(game_id, contains("team_id")), as.integer) %>%
  select(-winner_team_id)

games %>% 
  count(local_team_id, visitor_team_id, sort = T)

train <- games %>% 
  filter(year < 2019)
test <- games %>% 
  filter(year > 2018)
```


## POIS

```{r}
# devtools::install()
devtools::document()

rec <- recipe(local_team_score + visitor_team_score ~ local_team_id + visitor_team_id + game_id, data = head(games)) %>%
  update_role(game_id, new_role = "ID")

# f1 <- fit_learner(rec, games, params = NULL, task = "linear", backend = "goalmodel")
f2 <- learner$new(params = list(type = "pois"), task = "linear", backend = "goalmodel")
f2$fit_pair(rec, na.omit(train[1:100,]))

preds <- f2$predict_pair(test[1:100,], "w200")
preds
```


```{r}
# devtools::install()
devtools::document()

rec <- recipe(local_team_score + visitor_team_score ~ local_team_id + visitor_team_id + game_id, data = head(games)) %>%
  update_role(game_id, new_role = "ID")

# f1 <- fit_learner(rec, games, params = NULL, task = "linear", backend = "goalmodel")
f2 <- learner$new(params = list(init = 1500, k = 30), task = "linear", backend = "elo")
f2$fit_pair(rec, train[1:100,])

preds <- f2$predict_pair(test[3,], "w200")
f2$predict_pair(test[4,], "w200")
preds
```





